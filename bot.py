import discord
from discord.ext import commands
from discord.ui import Button, View, Modal, TextInput
import os

intents = discord.Intents.default()
intents.message_content = True
intents.members = True

bot = commands.Bot(command_prefix='!', intents=intents)

class VerifyModal(Modal):
    def __init__(self):
        super().__init__(title="‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô")
        self.birth_year = TextInput(label="‡∏û.‡∏®. ‡πÄ‡∏Å‡∏¥‡∏î", placeholder="", required=True)
        self.add_item(self.birth_year)

    async def on_submit(self, interaction: discord.Interaction):
        try:
            birth_year = int(self.birth_year.value)
            current_year = 2567  # ‡∏õ‡∏µ ‡∏û.‡∏®. ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            age = current_year - birth_year
            
            if age >= 16:
                role = discord.utils.get(interaction.guild.roles, name="Verified")
                if role:
                    await interaction.user.add_roles(role)
                    await interaction.response.send_message(f"{interaction.user.mention} ‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏¢‡∏® '{role.name}'!", ephemeral=True)

                    # ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ ID
                    channel_id = 1287752078491390002  # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ID ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
                    channel = bot.get_channel(channel_id)
                    if channel:
                        await channel.send(f"{interaction.user.mention} ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! üéâ", 
                                           embed=discord.Embed().set_image(url="https://i.pinimg.com/originals/97/20/79/972079b7a1f8c36bd570f4977c7bc98b.gif"))  # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå GIF ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                else:
                    await interaction.response.send_message(f"‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏¢‡∏® 'Verified' ‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ", ephemeral=True)
            else:
                await interaction.response.send_message(f"{interaction.user.mention} ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏≤‡∏¢‡∏∏‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á 16 ‡∏õ‡∏µ", ephemeral=True)

            await interaction.message.delete()
        except ValueError:
            await interaction.response.send_message("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡∏û.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç", ephemeral=True)

class VerifyButton(discord.ui.View):
    def __init__(self):
        super().__init__(timeout=None)

    @discord.ui.button(label="‚úÖ ‡∏Å‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô", style=discord.ButtonStyle.success)
    async def verify_button_callback(self, interaction: discord.Interaction, button: discord.ui.Button):
        modal = VerifyModal()
        await interaction.response.send_modal(modal)

@bot.event
async def on_ready():
    print(f'Logged in as {bot.user}')

@bot.command()
async def pig(ctx):
    view = VerifyButton()
    await ctx.send("‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô", view=view)

# ‡∏ú‡∏π‡∏Å‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Render
if __name__ == '__main__':
    port = int(os.environ.get('PORT', 8000))
    bot.run(os.getenv('DISCORD_TOKEN'))  # ‡πÉ‡∏ä‡πâ Environment Variable ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Token
